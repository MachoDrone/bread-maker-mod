services:
  spoof:
    build: .
    privileged: true
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    volumes:
      - .:/src:ro
    environment:
      - SPOOF_CPU=1
      - SPOOF_PCIE=1
      - SPOOF_DDR=1
      - SPOOF_TOPOLOGY=1
      - SPOOF_LOG=0

  detect:
    build: .
    privileged: true
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    entrypoint: ["/app/detect.sh"]
